{% extends "index.html" %}
{% block title %} Post List {% endblock %}

{% block body %}
<h2>All Posts</h2>
<table class="table table-striped">
<thead>
<tr>
<th>Type</th>
<th>Content</th>
<th>Author</th>
<th>Feed</th>
<th>
{% if user.id %}
  <div class="btn-group">
  <button type="button" class="btn btn-default" id="run_housekeeping"
          title="Archive old posts, delete really old posts">
    <span class="glyphicon glyphicon-compressed"></span>Do Housekeeping</button>
  <button type="button" class="btn btn-default" id="show_past_posts">Show Past Posts</button>

  {% if user.writeable_feeds() %}
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
    New Post <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
     {% for feed in user.writeable_feeds() %}
        <li><a href="{{ url_for('post_new', feed_id=feed.id) }}">{{ feed.name }}</a></li>
     {% endfor %}
  </ul>
  {% endif %}
  </div>
{% endif %}
</th>
</tr>
</thead>
<tbody>
{% for post in posts|sort(attribute="active_end") %}
    <tr class="time_{{- post.active_status() }}">
    <td>{{ post.type }}</td>
    <td>{{ linkmacros.post(post) }}</td>
    <td>{% if post.author %}
            {{linkmacros.user(post.author)}} (on {{ post.write_date.date() }})
        {% else %}
            No Author!
        {% endif %}
    </td>
    <td>{% if post.feed %}
           {{ linkmacros.feed(post.feed) }}&nbsp;
        {% else %}
            Not Published!
        {% endif %}
    </td>
    <td>{% if post.active_status()=="now" %}Active
        {% elif post.active_status()=="future" %}Display later
        {% elif post.active_status()=="past" %}
            {% if post.status == 0 %}Finished display lifetime
            {% else %}Archived
            {% endif %}
        {% endif %}
    </td>
    </tr>
{% endfor %}
</tbody>
</table>

<!-- careful of changing this next line, as unit tests require it. -->
{% if posts.count() == 0 %}
    <span class="post_count">No Posts at all!</span>
{% else %}
    <span class="post_count">{{ posts.count() }} posts</span>
{% endif %}

{% endblock %}
