{% extends "index.html" %}
{% block title %} Feed: {{ feed.name }} {% endblock %}

{% block body %}
<h1>Feed: {{ feed.name }} </h1>
<h2>Posts: </h2>
<table>
<thead>
  <tr>
    <td>Post</td>
    <td>Author</td>
    <td>Date</td>
    <td colspan=2>{% if feed.user_can_write(user) %}<a href="{{ url_for('post_new') }}?initial_feed={{ feed.id }}" class="newbutton">NEW</a>{% endif %}</td>
  </tr>
</thead>
<tbody>
{% for post in feed.posts %}
    <tr>
        <td>{{ linkmacros.post(post) }}</td>
        <td>{{ linkmacros.user(post.author) }}</td>
        <td>{{ post.write_date }}</td>
        <td>{{ 'Published' if post.published }}
            {% if feed.user_can_publish(user) %}
                <form method="POST" action="{{ url_for('postpage',postid=post.id) }}" >
                    <input type="hidden" name="action" value="
                        {{- 'unpublish' if post.published else 'publish' }}">
                    <input type="submit" value="
                        {{- 'Unpublish' if post.published else 'Publish' }}">
                </form>
            {% endif %}
        </td>
        <td>{% if (post.published and feed.user_can_publish(user)) or
                  ((not post.published) and feed.user_can_write(user)) %}
            <form method="POST" action="{{ url_for('postpage',postid=post.id) }}" >
            <input type="hidden" name="action" value="delete" />
            <input class="delbutton confirm_delete" type="submit" value="X" /></form>
            {% endif %}</td>
    </tr>
{% endfor %}
</tbody>
</table>
{% if user.is_admin %}
<form method="POST" id="users_and_groups">
<input type="hidden" name="action" value="edit" />
<div class="autowidth">
<h2>Permissions for this feed.</h2>
<div class="free_blocks">
    <h3>Author Users:</h3>
    {{ widgets.userselect("authors", allusers, feed.authors()) }}
</div>
<div class="free_blocks">
    <h3>Publisher Users:</h3>
    {{ widgets.userselect("publishers", allusers, feed.publishers()) }}
</div>

<div class="free_blocks">
    <h3>Author Groups:</h3>
    {{ widgets.groupselect("author_groups", allgroups, feed.author_groups()) }}
</div>
<div class="free_blocks">
    <h3>Publisher Groups:</h3>
    {{ widgets.groupselect("publisher_groups", allgroups, feed.publisher_groups()) }}
</div>
<input type="submit" value="Save">
</form>
{% else %}
<div class="leftside">
<h3>Authors who can post here:</h3>
{% for u in feed.authors() %}
<ul class="list">
  <li>{{ linkmacros.user(u) }}</li>
{% endfor %}
</div>
<div class="rightside">
<h3>Publishers</h3>
<ul class="list">
{% for u in feed.publishers() %}
  <li>{{ linkmacros.user(u) }}</li>
{% endfor %}
</ul>
</div>
{% endif %}
<div class="cf"></div>
</div>
{% endblock %}

{% block end_of_page_javascript %}
{{ super() }}
{% if not user.is_admin %}
<script type="text/javascript">
$('users_and_groups input').attr('disabled','disabled');
$('users_and_groups select').attr('disabled','disabled');
</script>
{% endif %}
{% endblock %}
